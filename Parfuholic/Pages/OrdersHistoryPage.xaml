<Page x:Class="Parfuholic.Pages.OrdersHistoryPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:models="clr-namespace:Parfuholic.Models"
      Background="White">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">
            <TextBlock Text="История заказов"
                       HorizontalAlignment="Center"
                       FontSize="24"
                       FontWeight="SemiBold"
                       Margin="0,0,0,30"/>

            <ItemsControl x:Name="OrdersList">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#DDD" BorderThickness="1" Padding="15" Margin="0,0,0,20" CornerRadius="5">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <!-- товары -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- правая часть -->
                                </Grid.ColumnDefinitions>

                                <!-- ЛЕВАЯ ЧАСТЬ: список товаров -->
                                <ItemsControl ItemsSource="{Binding Items}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <!-- Фото -->
                                                <Border Width="160"
                                                        Height="160"
                                                        Background="#FFF0F0F0"
                                                        Padding="0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center">
                                                    <Image Source="{Binding Perfume.Image}"
                                                           Stretch="UniformToFill"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           RenderOptions.BitmapScalingMode="HighQuality"/>
                                                </Border>

                                                <!-- Текст справа от фото -->
                                                <StackPanel Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding Perfume.Name}" FontSize="16" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Perfume.Brand}" FontSize="16" Foreground="Gray"/>
                                                    <TextBlock FontSize="14" Foreground="Gray">
                                                        <Run Text="Объем: "/>
                                                        <Run Text="{Binding Perfume.Volume}"/>
                                                    </TextBlock>
                                                    <TextBlock FontSize="14" Foreground="Gray">
                                                        <Run Text="Количество: "/>
                                                        <Run Text="{Binding Quantity}"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ПРАВАЯ ЧАСТЬ: данные о заказе -->
                                <StackPanel Grid.Column="1" Margin="40,0,0,0" VerticalAlignment="Center" Width="200">
                                    <TextBlock Text="{Binding Status}" 
                                               FontWeight="Bold" 
                                               Foreground="{Binding StatusColor}" 
                                               FontSize="16" 
                                               Margin="0,0,0,10"/>


                                    <TextBlock Text="{Binding OrderDate, StringFormat='Дата: {0:dd.MM.yyyy}'}" 
                                               Margin="0,0,0,5" FontSize="16"/>

                                    <TextBlock Text="{Binding TotalSum, StringFormat='Итог: {0:F2} BYN'}" 
                                               Margin="0,0,0,5" FontSize="16"/>

                                    <!-- ✅ Общая доставка для всего заказа с переносом строк -->
                                    <TextBlock Text="{Binding DeliveryInfo}" 
                                               TextWrapping="Wrap" 
                                               FontSize="16" 
                                               Margin="0,0,0,10"/>
                                    <Button Content="Отменить заказ"
                                            Width="140"
                                            Height="30"
                                            FontSize="16"
                                            Margin="0,5,56,0"
                                            Tag="{Binding OrderID}"
                                            Click="CancelOrder_Click"
                                            Background="White"
                                            BorderBrush="Black"
                                            BorderThickness="1"
                                            Foreground="Black"
                                            Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="White"/>
                                                <Setter Property="BorderBrush" Value="Black"/>
                                                <Setter Property="Foreground" Value="Black"/>
                                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="border" 
                                                                    Background="{TemplateBinding Background}" 
                                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                                    BorderThickness="{TemplateBinding BorderThickness}" 
                                                                    CornerRadius="0">
                                                                <ContentPresenter x:Name="contentPresenter" 
                                                                                  HorizontalAlignment="Center" 
                                                                                  VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="Black"/>
                                                                    <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="White"/>
                                                                </Trigger>
                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="#333333"/>
                                                                    <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="White"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </ScrollViewer>
</Page>
